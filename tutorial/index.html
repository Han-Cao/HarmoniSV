<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://han-cao.github.io/HarmoniSV/tutorial/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Tutorial - HarmoniSV</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/custom.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Tutorial";
        var mkdocs_page_input_path = "tutorial.md";
        var mkdocs_page_url = "/HarmoniSV/tutorial/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HarmoniSV
        </a>
        <div class="version">
          0.1.0
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quick_start/">Quick start</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Tutorial</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1-sv-discovery-using-various-methods">1. SV Discovery Using Various Methods</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-harmonize-vcfs">2. Harmonize VCFs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-merge-vcfs">3. Merge VCFs</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../command_list/">Command list</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../vcf_format/">VCF format</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">VCF manipulation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../VCF_manipulation/harmonize_header/">harmonize-header</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../VCF_manipulation/harmonize/">harmonize</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../VCF_manipulation/sample2pop.md">sample2pop</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../VCF_manipulation/intersect.md">intersect</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">SV analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../SV_analysis/represent/">represent</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SV_analysis/genotype/">genotype</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SV_analysis/filter/">filter</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../SV_analysis/concordance.md">concordance</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HarmoniSV</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Tutorial</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Han-Cao/HarmoniSV/docs/tutorial.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="tutorial">Tutorial</h1>
<p><strong><em> Last updated: 2024-01-16 </em></strong></p>
<p>This tutorial provides a step-by-step guide on how to utilize <code>harmonisv</code> for post-processing the outcomes of various SV calling methods and conducting joint SV calling across multiple samples and methods. The necessary input data and scripts for this tutorial can be found in the <a href="https://github.com/Han-Cao/HarmoniSV/tree/master/test">test</a> folder on GitHub.</p>
<h2 id="1-sv-discovery-using-various-methods">1. SV Discovery Using Various Methods</h2>
<p>Please note that <code>harmonisv</code> itself does not directly perform SV calling. Instead, it is designed to harmonize and integrate the results from any SV calling methods that generate a VCF file following the VCF specification and contains the essential information:</p>
<ul>
<li>Type of SV</li>
<li>Length of SV</li>
<li>Sequencing depth for both reference and alternative alleles</li>
</ul>
<p>In this tutorial, we employ two aligners, minimap2 and NGMLR, and three SV callers, cuteSV, sniffles, and SVIM, to call SVs in the HG002 sample.</p>
<p>Align long-read sequencing data to reference:</p>
<pre><code class="language-bash">ref=&quot;hs37d5.fa&quot;
input=&quot;HG002.fasta&quot;

# minimap2
minimap2 -L -t 36 --MD -a -x map-pb $ref $input | samtools sort -@ 4 -o $bam

# NGMLR
ngmlr --bam-fix -t 40 -x pacbio \
-r $ref \
-q $input \
-o $bam
</code></pre>
<p>Call SVs from alignments:</p>
<pre><code class="language-bash"># sniffles (ver 2.0.6)
sniffles \
-i $bam \
-v $vcf \
--reference $ref \
--tandem-repeats &quot;human_hs37d5.trf.bed&quot;

# SVIM (ver 2.0.0)
svim alignment $outpath $input $ref \
--max_sv_size 1000000

# cuteSV (ver 2.0.3)
cuteSV \
--max_cluster_bias_INS 100 \
--diff_ratio_merging_INS 0.3 \
--max_cluster_bias_DEL 200 \
--diff_ratio_merging_DEL 0.5 \
--genotype \
$input $ref $vcf $workdir

</code></pre>
<p>After running the above commands, we get the following VCF files:</p>
<ul>
<li>HG002.minimap2.sniffles.vcf</li>
<li>HG002.minimap2.svim.vcf</li>
<li>HG002.minimap2.cuteSV.vcf</li>
<li>HG002.NGMLR.sniffles.vcf</li>
<li>HG002.NGMLR.svim.vcf</li>
<li>HG002.NGMLR.cuteSV.vcf</li>
</ul>
<h2 id="2-harmonize-vcfs">2. Harmonize VCFs</h2>
<p>The output VCF files from different SV calling methods usually have different formats in their <code>INFO</code> and <code>FORMAT</code> fields. To integrate the results from different methods, we first need to harmonize the VCFs to a standard format. This is because when we rename or move VCF tags (e.g., FORMAT/tag to INFO/tag), the newly added tags should also have definition in the header according to the VCF specification. Here, we first use <code>harmonize-header</code> to combine the headers from all input VCFs.</p>
<pre><code class="language-bash"># If one tag is defined in multiple VCFs
# the one from the reference VCF or the first VCF in the list will be used
harmonisv harmonize-header \
-f vcf_list.txt \                # read VCF list from file
-o harmonized_header.txt \       # output file
-r HG002.minimap2.sniffles.vcf   # reference VCF file (optional)
</code></pre>
<p>Then, we can use <code>harmonize</code> to standardize the VCFs:</p>
<ol>
<li>reheader with <code>harmonized_header.txt</code></li>
<li>for the same information stored in different tags, rename them to the same tag</li>
<li>normalize SV types to the same format (e.g., <code>DUP:TANDEM</code> to <code>DUP</code>)</li>
<li>extract all required tags to <code>INFO</code> field</li>
<li>rename SV ID to make them unique across samples and methods</li>
</ol>
<pre><code class="language-bash"># sniffles
harmonisv harmonize \
-i HG002.minimap2.sniffles.vcf \
-o HG002.minimap2.sniffles.harmonized.vcf \
--info SVTYPE,SVLEN,END,STRANDS=STRAND \        # INFO tags to be kept
--format-to-info RE=DV \                        # extract FORMAT/DV to INFO/RE
--format-to-info-sum DP=DR,DP=DV \              # INFO/DP = FORMAT/DR + FORMAT/DV
--header harmonized_header.txt \                # reheader
--id-prefix HG002.minimap2.sniffles \           # add sample ID and method as prefix to SV ID
--rename-id                                     # rename SV ID to prefix.chr.svtype.number

# SVIM
harmonisv harmonize \
-i HG002.minimap2.svim.vcf \
-o HG002.minimap2.svim.harmonized.vcf \
--info SVTYPE,SVLEN,END,RE=SUPPORT \            # INFO tags to be kept
--format-to-info DP=DP \                        # extract FORMAT/DP to INFO/DP
--DUP DUP,DUP:TANDEM,DUP:INT \                  # normalize SV types
--header harmonized_header.txt \                # reheader
--id-prefix HG002.minimap2.svim \               # add sample ID and method as prefix to SV ID
--rename-id                                     # rename SV ID to prefix.chr.svtype.number

# cuteSV
harmonisv harmonize \
-i HG002.minimap2.cuteSV.vcf \
-o HG002.minimap2.cuteSV.harmonized.vcf \
--info SVTYPE,SVLEN,END,RE \                   # INFO tags to be kept
--format-to-info-sum DP=DR,DP=DV \             # INFO/DP = FORMAT/DR + FORMAT/DV
--header harmonized_header.txt \               # reheader    
--id-prefix HG002.minimap2.cuteSV \            # add sample ID and method as prefix to SV ID
--rename-id                                    # rename SV ID to prefix.chr.svtype.number
</code></pre>
<h2 id="3-merge-vcfs">3. Merge VCFs</h2>
<p>Ongoing...</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../quick_start/" class="btn btn-neutral float-left" title="Quick start"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../command_list/" class="btn btn-neutral float-right" title="Command list">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Han-Cao/HarmoniSV/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../quick_start/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../command_list/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
